{% extends 'base.html' %}
{% block content %}

    <h2>Your Classes</h2>
    <h3>Add a new class</h3>
    <form action="/new_class" method="POST">
        <div>
            <label>Class name:
                <input type="text" name="class_name" required>
            </label>
            <input type="hidden" name="teacher" value="{{ session['user_id'] }}">
            <input type="submit" value="Create">
        </div>
    </form>
    
    <h3>Your classes</h3>
    <ul>
    {% for class_id in class_list.keys() %}

        <li><b>{{ class_list[class_id]['class_name'] }}</b> 
        <button class="delete_class" data-classid="{{ class_id }}">x</button>
        </li></form>

            {% if 'students' in class_list[class_id] %}
              <ul>
                {% for student in class_list[class_id]['students'] %}
                <li>
                {{ student.first_name }} {{ student.last_name }} 
                (<a href="/profile/{{student.user_id}}">{{student.username}}</a>) 
                <button class="remove_student" data-classid="{{ class_id }}" data-studentid="{{ student.user_id }}">x</button>
                </form>

                </li>
                {% endfor %}
              </ul>
            {% endif %}
    {% endfor %}
    </ul>

    <h3>Add student by username</h3>
    <form action="/add_student" method="POST">
        <div>
            <label>Username:
                <input type="text" name="username" required>
            </label><br>
            <select name="class-id">
              {% for class_id in class_list.keys() %}
              <option value="{{ class_id }}">{{ class_list[class_id]['class_name'] }}</option>
              {% endfor %}
            </select>
            <input type="hidden" name="teacher" value="{{ session['user_id'] }}">
            <input type="submit" value="Add to class">
        </div>
    </form>

    <h3>Create new student account</h3>

    <form action="/new_student" method="POST">
    <div>
        <label>
            First name: 
            <input type="text" name="first" required>
        </label><br><br>
    </div>

    <div>
        <label>
            Last name: 
            <input type="text" name="last" required>
        </label><br><br>
    </div>

    <div>
        <label>
            Preferred name: 
            <input type="text" name="preferred">
        </label><br><br>
    </div>

    <div>
        <label>
            Email:
            <input type="email" name="email">
        </label><br><br>
    </div>

    <div>
        <label>
            Username: 
            <input type="text" name="username" required>
        </label><br><br>
    </div>

    <div>
        <label>
            Password:
            <input type="password" name="password" required>
        </label><br><br>
    </div>

    <div>
        Class:
        <select name="class-id">
          {% for class_id in class_list.keys() %}
          <option value="{{ class_id }}">{{ class_list[class_id]['class_name'] }}</option>
          {% endfor %}
        </select><br><br>
    </div>

    <div>
        <input type="hidden" name="teacher" value="{{ session['user_id'] }}">
        <input type="submit" value="Create Account">
    </div>
</form>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script>
    function confirmDelete(result) {
        window.location.reload()
        console.log("Class deleted successfully!");
    }

    function deleteClass(evt) {
      evt.preventDefault();

      var formValues = {
        'class_id' : $(this).attr('data-classid')
      };

      if (confirm('Are you sure you want to delete this class? The students in this class will no longer have access to it.')) {
        $.post("/delete_class", formValues, confirmDelete);
      }
    }

    $("button.delete_class").on("click", deleteClass);


    function confirmRemove(result) {
      window.location.reload()
      console.log("Student deleted successfully!");
    }

    function removeStudent(evt) {
      evt.preventDefault();

      var formValues = {
        'class_id' : $(this).attr('data-classid'),
        'user_id' : $(this).attr('data-studentid')
      };

      if (confirm('Are you sure you want to remove this student from your class? This will not delete the student\'s account.')) {
        $.post("/remove_student", formValues, confirmRemove);
      }
    }

    $("button.remove_student").on("click", removeStudent);

</script>

{% endblock %}